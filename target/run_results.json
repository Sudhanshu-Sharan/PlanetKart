{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.4", "generated_at": "2025-07-21T02:23:36.144590Z", "invocation_id": "7e3a3e9e-428f-4a97-a071-0e51d863504a", "invocation_started_at": "2025-07-21T02:23:26.879847Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:29.942180Z", "completed_at": "2025-07-21T02:23:29.978803Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:29.979567Z", "completed_at": "2025-07-21T02:23:30.258617Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.31752705574035645, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2b93-0000-000a0e0af2a5"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.stg_customers", "compiled": true, "compiled_code": "\n\nselect\n    customer_id,\n    trim(first_name || ' ' || last_name) as customer_name,\n    lower(trim(email)) as email,\n    region_id,\n    signup_date::timestamp as signup_date,\n    datediff('day', signup_date, current_date()) as days_since_signup,\n    case \n        when datediff('day', signup_date, current_date()) <= 30 then 'New'\n        when datediff('day', signup_date, current_date()) <= 90 then 'Recent'\n        else 'Established'\n    end as customer_tenure,\n    case when email like '%@%.%' then 'Valid' else 'Invalid' end as email_status\nfrom planetkart.planetkart_raw.customers\nwhere customer_id is not null", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_customers", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:30.268638Z", "completed_at": "2025-07-21T02:23:30.279125Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:30.279613Z", "completed_at": "2025-07-21T02:23:30.467099Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.19941496849060059, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2a9a-000a-0e0a00011142"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.stg_order_items", "compiled": true, "compiled_code": "\n\nselect\n    order_id,\n    product_id,\n    quantity,\n    unit_price,\n    \n    -- Key metrics for analysis\n    quantity * unit_price as line_total\n    \nfrom planetkart.planetkart_raw.order_items\nwhere order_id is not null and product_id is not null", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_order_items", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:30.473101Z", "completed_at": "2025-07-21T02:23:30.486583Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:30.487209Z", "completed_at": "2025-07-21T02:23:30.683181Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.2114109992980957, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2a72-000a-0e0a000101fa"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.stg_orders", "compiled": true, "compiled_code": "\n\nselect\n    order_id,\n    customer_id,\n    order_date::timestamp as order_date,\n    lower(trim(status)) as order_status,\n    \n    -- Useful for analysis\n    case when lower(status) = 'completed' then 1 else 0 end as is_completed,\n    date_trunc('month', order_date::timestamp) as order_month\n    \nfrom planetkart.planetkart_raw.orders\nwhere order_id is not null", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_orders", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:30.689407Z", "completed_at": "2025-07-21T02:23:30.704251Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:30.704839Z", "completed_at": "2025-07-21T02:23:30.916832Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.22874999046325684, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2b93-0000-000a0e0af2a9"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.stg_products", "compiled": true, "compiled_code": "\n\nselect\n    product_id,\n    trim(product_name) as product_name,\n    trim(category) as category,\n    trim(sku) as sku,\n    cost,\n    \n    -- Basic data cleaning\n    case when cost <= 0 or cost is null then 'Invalid' else 'Valid' end as cost_flag,\n    upper(left(category, 1)) || lower(substring(category, 2)) as category_clean\n    \nfrom planetkart.planetkart_raw.products\nwhere product_id is not null", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_products", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:30.922308Z", "completed_at": "2025-07-21T02:23:30.935287Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:30.935853Z", "completed_at": "2025-07-21T02:23:31.172946Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.25194478034973145, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2b9d-0000-000a0e0ae7d1"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.stg_regions", "compiled": true, "compiled_code": "\n\nselect\n    region_id,\n    upper(trim(planet)) as planet,\n    upper(trim(zone)) as zone\n    \nfrom planetkart.planetkart_raw.regions\nwhere region_id is not null", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_regions", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:31.178026Z", "completed_at": "2025-07-21T02:23:31.214910Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:31.215506Z", "completed_at": "2025-07-21T02:23:32.299525Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.1228199005126953, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2a9a-000a-0e0a00011146"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.dim_customers", "compiled": true, "compiled_code": "\n\nwith customer_metrics as (\n    select \n        c.customer_id,\n        c.customer_name,\n        c.email,\n        c.region_id,\n        c.signup_date,\n        c.customer_tenure,\n        \n        count(o.order_id) as total_orders,\n        count(case when o.order_status = 'completed' then 1 end) as completed_orders,\n        sum(case when o.order_status = 'completed' then oi.line_total else 0 end) as total_revenue,\n        avg(case when o.order_status = 'completed' then oi.line_total end) as avg_order_value,\n        sum(case when o.order_status = 'completed' then oi.line_total - (p.cost * oi.quantity) else 0 end) as total_profit,\n        max(o.order_date) as last_order_date\n        \n    from PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_customers c\n    left join PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_orders o on c.customer_id = o.customer_id\n    left join PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_order_items oi on o.order_id = oi.order_id\n    left join PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_products p on oi.product_id = p.product_id\n    group by 1,2,3,4,5,6\n)\n\nselect \n    md5(cast(coalesce(cast(customer_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as customer_sk,\n    customer_id,\n    customer_name,\n    email,\n    region_id,\n    signup_date,\n    customer_tenure,\n    total_orders,\n    completed_orders,\n    coalesce(total_revenue, 0) as total_revenue,\n    coalesce(total_profit, 0) as total_profit,\n    last_order_date,\n    \n    -- Revenue segments\n    case \n        when coalesce(total_revenue, 0) >= 150 then 'High_Value'\n        when coalesce(total_revenue, 0) >= 80 then 'Medium_Value'\n        when coalesce(total_revenue, 0) > 0 then 'Low_Value'\n        else 'No_Purchase'\n    end as revenue_segment,\n    \n    -- Profit segments\n    case \n        when coalesce(total_profit, 0) >= 20 then 'Highly_Profitable'\n        when coalesce(total_profit, 0) >= 5 then 'Profitable'\n        when coalesce(total_profit, 0) > 0 then 'Low_Profit'\n        else 'Unprofitable'\n    end as profit_segment,\n    \n    -- Lifecycle stage (behavior-based)\n    case \n        when total_orders = 0 then 'Never_Purchased'\n        when total_orders >= 3 then 'Loyal_Customer'\n        when total_orders = 2 then 'Repeat_Customer'\n        when coalesce(total_revenue, 0) >= 200 then 'High_Value_Single'\n        else 'One_Time_Buyer'\n    end as lifecycle_stage,\n    \n    -- Customer type segmentation\n    case \n        when total_orders >= 2 and coalesce(total_revenue, 0) >= 300 then 'VIP_Customer'\n        when total_orders >= 2 and coalesce(total_revenue, 0) >= 150 then 'Premium_Repeat'\n        when total_orders >= 2 then 'Standard_Repeat'\n        when coalesce(total_revenue, 0) >= 200 then 'High_Potential'\n        else 'Standard_Single'\n    end as customer_type,\n    \n    -- CHURN ANALYSIS\n    case \n        when total_orders = 0 then 'Never_Active'\n        when last_order_date >= '2024-06-01' then 'Currently_Active'\n        when last_order_date >= '2024-05-01' then 'Recently_Active'\n        when last_order_date >= '2024-04-01' then 'At_Risk'\n        when last_order_date >= '2024-03-01' then 'High_Churn_Risk'\n        else 'Likely_Churned'\n    end as churn_risk,\n    \n    -- Engagement pattern analysis\n    case \n        when total_orders = 0 then 'No_Engagement'\n        when total_orders >= 3 then 'High_Engagement'\n        when total_orders = 2 then 'Repeat_Engagement'\n        else 'Single_Engagement'\n    end as engagement_pattern,\n    \n    -- Profit margin calculation\n    case \n        when coalesce(total_revenue, 0) > 0 then round((coalesce(total_profit, 0) / total_revenue) * 100, 1)\n        else 0 \n    end as profit_margin_pct,\n    \n    current_timestamp() as created_at\n\nfrom customer_metrics", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_customers", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:32.305291Z", "completed_at": "2025-07-21T02:23:32.325905Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:32.326505Z", "completed_at": "2025-07-21T02:23:33.259304Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.9551680088043213, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2a9a-000a-0e0a0001114a"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.dim_products", "compiled": true, "compiled_code": "\n\nwith product_metrics as (\n    select \n        p.product_id,\n        p.product_name,\n        p.category,\n        p.sku,\n        p.cost,\n        \n        count(oi.order_id) as total_sales,\n        sum(oi.quantity) as total_quantity_sold,\n        sum(oi.line_total) as total_revenue,\n        avg(oi.unit_price) as avg_selling_price,\n        sum(oi.line_total - (p.cost * oi.quantity)) as total_profit,\n        avg(oi.unit_price - p.cost) as avg_profit_per_unit,\n        count(distinct o.customer_id) as unique_customers,\n        max(o.order_date) as last_sold_date\n        \n    from PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_products p\n    left join PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_order_items oi on p.product_id = oi.product_id\n    left join PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_orders o on oi.order_id = o.order_id \n    where o.order_status = 'completed' or o.order_status is null\n    group by 1,2,3,4,5\n)\n\nselect \n    md5(cast(coalesce(cast(product_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as product_sk,\n    product_id,\n    product_name,\n    category,\n    sku,\n    cost,\n    coalesce(total_sales, 0) as total_sales,\n    coalesce(total_quantity_sold, 0) as total_quantity_sold,\n    coalesce(total_revenue, 0) as total_revenue,\n    coalesce(total_profit, 0) as total_profit,\n    coalesce(unique_customers, 0) as unique_customers,\n    last_sold_date,\n    \n    case \n        when coalesce(total_profit, 0) >= 30 then 'High_Profit'\n        when coalesce(total_profit, 0) >= 10 then 'Medium_Profit'\n        when coalesce(total_profit, 0) > 0 then 'Low_Profit'\n        when coalesce(total_profit, 0) < 0 then 'Loss_Making'\n        else 'Never_Sold'\n    end as profit_segment,\n    \n    case \n        when coalesce(total_sales, 0) >= 3 then 'Best_Seller'\n        when coalesce(total_sales, 0) >= 2 then 'Good_Seller'\n        when coalesce(total_sales, 0) = 1 then 'Slow_Mover'\n        else 'No_Sales'\n    end as sales_performance,\n    \n    case \n        when coalesce(total_revenue, 0) > 0 then round((coalesce(total_profit, 0) / total_revenue) * 100, 1)\n        else 0 \n    end as profit_margin_pct,\n    \n    current_timestamp() as created_at\n\nfrom product_metrics", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_products", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:33.264390Z", "completed_at": "2025-07-21T02:23:33.284824Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:33.285521Z", "completed_at": "2025-07-21T02:23:34.385937Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.122955083847046, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2a72-000a-0e0a000101fe"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.fact_orders", "compiled": true, "compiled_code": "\n\nwith order_facts as (\n    select \n        o.order_id,\n        o.customer_id,\n        c.region_id,\n        o.order_date,\n        o.order_status,\n        \n        -- Order metrics (aggregated from order items)\n        sum(oi.quantity) as total_quantity,\n        sum(oi.line_total) as order_revenue,\n        sum(p.cost * oi.quantity) as order_cost,\n        sum(oi.line_total - (p.cost * oi.quantity)) as order_profit,\n        count(oi.product_id) as products_count\n        \n    from PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_orders o\n    left join PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_order_items oi on o.order_id = oi.order_id\n    left join PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_products p on oi.product_id = p.product_id\n    left join PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_customers c on o.customer_id = c.customer_id\n    group by o.order_id, o.customer_id, c.region_id, o.order_date, o.order_status\n)\n\nselect \n    -- Surrogate keys for star schema\n    md5(cast(coalesce(cast(order_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as order_sk,\n    md5(cast(coalesce(cast(customer_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as customer_sk,\n    md5(cast(coalesce(cast(region_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as region_sk,\n    \n    -- Natural keys\n    order_id,\n    customer_id,\n    region_id,\n    order_date,\n    order_status,\n    \n    -- Measures\n    total_quantity,\n    order_revenue,\n    order_cost,\n    order_profit,\n    products_count,\n    \n    -- Business metrics\n    case \n        when order_profit >= 20 then 'High_Profit'\n        when order_profit >= 5 then 'Medium_Profit'\n        when order_profit > 0 then 'Low_Profit'\n        else 'No_Profit'\n    end as profit_tier,\n    \n    case \n        when order_revenue >= 150 then 'Large'\n        when order_revenue >= 80 then 'Medium'\n        else 'Small'\n    end as order_size,\n    \n    case when order_status = 'completed' then 1 else 0 end as is_completed,\n    \n    current_timestamp() as created_at\n\nfrom order_facts", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.fact_orders", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:34.391028Z", "completed_at": "2025-07-21T02:23:34.408427Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:34.409083Z", "completed_at": "2025-07-21T02:23:34.942426Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.5525901317596436, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2a72-000a-0e0a00010202"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.dim_regions", "compiled": true, "compiled_code": "\n\nselect \n    md5(cast(coalesce(cast(region_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as region_sk,\n    region_id,\n    planet,\n    zone,\n    \n    case \n        when planet = 'Earth' then 'Home_Base'\n        when planet in ('Mars', 'Venus') then 'Expansion_Territory' \n        else 'Frontier'\n    end as market_category,\n    \n    case \n        when planet = 'Earth' then 1\n        when planet = 'Mars' then 2  \n        when planet = 'Venus' then 3\n        else 4\n    end as expansion_order,\n    \n    current_timestamp() as created_at\n\nfrom PLANETKART.PLANETKART_ANALYTICS_planetkart_stage.stg_regions", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_regions", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:34.948488Z", "completed_at": "2025-07-21T02:23:34.962818Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:34.963495Z", "completed_at": "2025-07-21T02:23:35.198120Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.2508680820465088, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2b9d-0000-000a0e0ae7d5"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.customer_insights", "compiled": true, "compiled_code": "\n\n-- Customer Intelligence Dashboard\n-- Shows key customer segments and behavioral patterns\n\nSELECT \n    -- Customer segmentation summary\n    revenue_segment,\n    lifecycle_stage,\n    COUNT(*) as customer_count,\n    ROUND(AVG(total_revenue), 2) as avg_revenue_per_customer,\n    ROUND(AVG(total_profit), 2) as avg_profit_per_customer,\n    ROUND(AVG(profit_margin_pct), 1) as avg_margin_pct,\n    \n    -- Business insights\n    ROUND(SUM(total_revenue), 2) as segment_total_revenue,\n    ROUND(SUM(total_profit), 2) as segment_total_profit,\n    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 1) as pct_of_customers,\n    ROUND(SUM(total_revenue) * 100.0 / SUM(SUM(total_revenue)) OVER(), 1) as pct_of_revenue\n\nFROM PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_customers\nWHERE total_orders > 0\nGROUP BY revenue_segment, lifecycle_stage\nORDER BY segment_total_profit DESC\n\n-- Customer segment profitability, where to focus retention efforts, which segments drive revenue", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_advance_analytics.customer_insights", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:35.203771Z", "completed_at": "2025-07-21T02:23:35.215421Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:35.216064Z", "completed_at": "2025-07-21T02:23:35.456884Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.25437211990356445, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2a9a-000a-0e0a0001114e"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.product_insights", "compiled": true, "compiled_code": "--Product Performance\n\n\n\n-- Product Portfolio Analysis\n-- Identifies winners, losers, and opportunities\n\nSELECT \n    category,\n    profit_segment,\n    COUNT(*) as products_in_segment,\n    ROUND(SUM(total_revenue), 2) as category_revenue,\n    ROUND(SUM(total_profit), 2) as category_profit,\n    ROUND(AVG(profit_margin_pct), 1) as avg_margin,\n    \n    -- Top performer in each category\n    MAX(CASE WHEN total_profit > 0 THEN product_name END) as top_product,\n    MAX(total_profit) as highest_profit,\n    \n    -- Performance insights\n    ROUND(SUM(total_revenue) * 100.0 / SUM(SUM(total_revenue)) OVER(), 1) as pct_of_total_revenue,\n    COUNT(CASE WHEN sales_performance = 'Best_Seller' THEN 1 END) as best_sellers_count\n\nFROM PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_products\nGROUP BY category, profit_segment\nHAVING SUM(total_revenue) > 0\nORDER BY category_profit DESC\n\n--Which categories are most profitable, product mix optimization, inventory focus areas", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_advance_analytics.product_insights", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:35.462827Z", "completed_at": "2025-07-21T02:23:35.482220Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:35.482852Z", "completed_at": "2025-07-21T02:23:35.783987Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.32254791259765625, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2b93-0000-000a0e0af2ad"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.business_kpis", "compiled": true, "compiled_code": "\n\n-- Executive KPI Dashboard - Fixed Single Row Results\nWITH core_metrics AS (\n    SELECT \n        SUM(order_revenue) as total_revenue,\n        SUM(order_profit) as total_profit,\n        ROUND(AVG(order_revenue), 2) as avg_order_value,\n        COUNT(DISTINCT customer_id) as unique_customers\n    FROM PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.fact_orders\n    WHERE is_completed = 1\n),\n\ncustomer_metrics AS (\n    SELECT \n        COUNT(*) as total_active_customers,\n        COUNT(CASE WHEN total_orders >= 2 THEN 1 END) as repeat_customers,\n        COUNT(CASE WHEN revenue_segment = 'High_Value' THEN 1 END) as high_value_customers\n    FROM PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_customers\n    WHERE total_orders > 0\n),\n\nproduct_metrics AS (\n    SELECT \n        MAX(total_profit) as max_profit,\n        MAX(total_sales) as max_sales\n    FROM PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_products\n),\n\ntop_product AS (\n    SELECT \n        product_name as most_profitable_product\n    FROM PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_products\n    WHERE total_profit = (SELECT MAX(total_profit) FROM PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_products)\n    LIMIT 1\n),\n\nbest_seller AS (\n    SELECT \n        product_name as best_selling_product\n    FROM PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_products\n    WHERE total_sales = (SELECT MAX(total_sales) FROM PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_products)\n    LIMIT 1\n),\n\nregional_metrics AS (\n    SELECT \n        COUNT(DISTINCT planet) as planets_served\n    FROM PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_regions\n)\n\nSELECT \n    'PlanetKart Executive Summary' as report_title,\n    CURRENT_DATE() as report_date,\n    \n    -- Financial Metrics\n    cm.total_revenue,\n    cm.total_profit,\n    cm.avg_order_value,\n    \n    -- Customer Metrics\n    custm.total_active_customers,\n    custm.repeat_customers,\n    custm.high_value_customers,\n    \n    -- Product Performance\n    tp.most_profitable_product,\n    pm.max_profit as highest_product_profit,\n    bs.best_selling_product,\n    pm.max_sales as highest_sales_count,\n    \n    -- Regional Data\n    rm.planets_served,\n    \n    -- Business Ratios\n    ROUND(cm.total_profit / cm.total_revenue * 100, 1) as overall_profit_margin,\n    ROUND(custm.repeat_customers * 100.0 / custm.total_active_customers, 1) as repeat_customer_rate\n\nFROM core_metrics cm\nCROSS JOIN customer_metrics custm\nCROSS JOIN product_metrics pm\nCROSS JOIN top_product tp\nCROSS JOIN best_seller bs\nCROSS JOIN regional_metrics rm", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_advance_analytics.business_kpis", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-07-21T02:23:35.789839Z", "completed_at": "2025-07-21T02:23:35.800128Z"}, {"name": "execute", "started_at": "2025-07-21T02:23:35.800694Z", "completed_at": "2025-07-21T02:23:36.030318Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.24176597595214844, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bdd3cf-0001-2a72-000a-0e0a00010206"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.planetkart_analytics.regional_insights", "compiled": true, "compiled_code": "--Regional Performance\n\n\n\n-- Multi-Planetary Market Analysis\n-- Regional expansion and performance insights\n\nSELECT \n    r.planet,\n    r.market_category,\n    \n    -- Market size metrics\n    COUNT(DISTINCT f.customer_id) as unique_customers,\n    COUNT(f.order_id) as total_orders,\n    ROUND(SUM(f.order_revenue), 2) as total_revenue,\n    ROUND(SUM(f.order_profit), 2) as total_profit,\n    \n    -- Performance metrics\n    ROUND(AVG(f.order_revenue), 2) as avg_order_value,\n    ROUND(SUM(f.order_profit) / SUM(f.order_revenue) * 100, 1) as profit_margin_pct,\n    ROUND(COUNT(f.order_id) * 1.0 / COUNT(DISTINCT f.customer_id), 1) as orders_per_customer,\n    \n    -- Market insights\n    ROUND(SUM(f.order_revenue) * 100.0 / SUM(SUM(f.order_revenue)) OVER(), 1) as market_share_pct\n\nFROM PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.fact_orders f\nJOIN PLANETKART.PLANETKART_ANALYTICS_planetkart_analytics.dim_regions r ON f.region_sk = r.region_sk\nWHERE f.is_completed = 1\nGROUP BY r.planet, r.market_category\nORDER BY total_profit DESC\n\n-- Which planets are most profitable, expansion opportunities, market penetration rates", "relation_name": "PLANETKART.PLANETKART_ANALYTICS_advance_analytics.regional_insights", "batch_results": null}], "elapsed_time": 7.681442737579346, "args": {"require_yaml_configuration_for_mf_time_spines": false, "require_explicit_package_overrides_for_builtin_materializations": true, "introspect": true, "require_nested_cumulative_type_params": false, "partial_parse": true, "validate_macro_args": false, "quiet": false, "log_format_file": "debug", "require_all_warnings_handled_by_warn_error": false, "write_json": true, "send_anonymous_usage_stats": true, "log_file_max_bytes": 10485760, "show_resource_report": false, "static_parser": true, "log_level_file": "debug", "log_format": "default", "invocation_command": "dbt run", "log_path": "/Users/sudahnshusharan/planetkart_analytics/planetkart-analytics/logs", "use_colors_file": true, "select": [], "indirect_selection": "eager", "vars": {}, "print": true, "exclude": [], "warn_error_options": {"error": [], "warn": [], "silence": []}, "version_check": true, "require_batched_execution_for_custom_microbatch_strategy": false, "partial_parse_file_diff": true, "defer": false, "cache_selected_only": false, "source_freshness_run_project_hooks": true, "macro_debugging": false, "empty": false, "populate_cache": true, "which": "run", "show_all_deprecations": false, "upload_to_artifacts_ingest_api": false, "log_level": "info", "project_dir": "/Users/sudahnshusharan/planetkart_analytics/planetkart-analytics", "state_modified_compare_more_unrendered_values": false, "use_fast_test_edges": false, "require_resource_names_without_spaces": true, "favor_state": false, "skip_nodes_if_on_run_start_fails": false, "strict_mode": false, "profiles_dir": "/Users/sudahnshusharan/.dbt", "use_colors": true, "state_modified_compare_vars": false, "printer_width": 80}}